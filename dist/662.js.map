{"version":3,"sources":["webpack://microlib-example/./src/domain/utils.js","webpack://microlib-example/./src/services/address-service.js","webpack://microlib-example/./src/services/event-bus.js","webpack://microlib-example/./src/services/index.js","webpack://microlib-example/./src/services/inventory-service.js","webpack://microlib-example/./src/services/payment-service.js","webpack://microlib-example/./src/services/shipping-service.js"],"names":["compose","funcs","initVal","reduceRight","val","func","composeAsync","then","Promise","resolve","passwd","process","env","ENCRYPTION_PWD","algo","key","crypto","String","iv","Buffer","alloc","encrypt","text","cipher","encrypted","update","decrypt","cipherText","console","log","decipher","decrypted","hash","data","digest","uuid","nanoid","makeArray","v","Array","isArray","makeObject","prop","reduce","p","c","async","promise","result","ok","object","asObject","asArray","error","require","SmartyStreetsSDK","SmartyStreetsCore","core","Lookup","usStreet","disabled","SMARTY_DISABLED","authId","SMARTY_AUTH_ID","authToken","SMARTY_AUTH_TOKEN","credentials","StaticCredentials","client","buildClient","Address","validateAddress","address","lookup","inputId","street","maxCandidates","send","response","Error","candidate","lookups","validatedAddress","deliveryLine1","deliveryLine2","lastLine","join","_notify","notify","Event","_listen","listen","model","EventBus","topic","message","args","options","Payment","authorizePayment","id","amount","source_id","customer_id","autocomplete","currency","payload","idempotency_key","amount_money","location_id","reference_id","note","app_fee_money","completePayment","orderNo","refundPayment","createEventMessage","requester","service","type","name","eventSource","eventTarget","eventType","eventName","eventTime","Date","getTime","eventUuid","eventData","createCommandEvent","commandName","commandResp","commandArgs","Shipping","serviceName","shipOrder","shipTo","shipFrom","lineItems","signature","externalId","respondOn","trackShipment","shipmentId","trackingId","verifyDelivery","returnShipment","getPayload","event","payloads","trackingStatus","proofOfDelivery","getProperty"],"mappings":"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nBC,SAbmB,EAcnBC,WAdmB,EAiBnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFAC,0BAEA,0EAFe,KAEf;AADAC,sBACA,0EADW,KACX;AACMC,qBADN,GACgB;AACdC,+BAAe,EAAEP,EADH;AAEdQ,4BAAY,EAAE;AACZP,wBAAM,EAANA,MADY;AAEZI,0BAAQ,EAARA;AAFY,iBAFA;AAMdH,yBAAS,EAATA,SANc;AAOdE,4BAAY,EAAZA,YAPc;AAQdD,2BAAW,EAAXA,WARc;AASdM,2BAAW,EAAE,eATC;AAUdC,4BAAY,EAAE,QAVA;AAWdC,oBAAI,EAAE,mBAXQ;AAYdC,6BAAa,EAAE;AACbX,wBAAM,EAAE,EADK;AAEbI,0BAAQ,EAAE;AAFG;AAZD,eADhB;AAkBA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAvDI,+CA6DO,MA7DP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8DD,GA/EoB;;AAiFrB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEQQ,iBAzJe,2BAyJCrB,KAzJD,EAyJQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAC3BhE,qBAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2C+D,KAAK,CAACsB,OAAjD;AAD2B,gDAEpB,MAFoB;;AAAA;AAAA;AA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","file":"662.js","sourcesContent":["\"use strict\";\n\nimport crypto from \"crypto\";\nimport { nanoid } from \"nanoid\";\n\nexport function compose(...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight((val, func) => func(val), initVal);\n  };\n}\n\nexport function composeAsync(...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight(\n      (val, func) => val.then(func),\n      Promise.resolve(initVal)\n    );\n  };\n}\n\nconst passwd = process.env.ENCRYPTION_PWD;\nconst algo = \"aes-192-cbc\";\nconst key = crypto.scryptSync(String(passwd), \"salt\", 24);\nconst iv = Buffer.alloc(16, 0);\n\nexport function encrypt(text) {\n  const cipher = crypto.createCipheriv(algo, key, iv);\n  let encrypted = cipher.update(text, \"utf8\", \"hex\");\n  encrypted += cipher.final(\"hex\");\n  return encrypted;\n}\n\nexport function decrypt(cipherText) {\n  console.log(\"decrypt(%s)\", cipherText);\n  const decipher = crypto.createDecipheriv(algo, key, iv);\n  let decrypted = decipher.update(cipherText, \"hex\", \"utf8\");\n  decrypted += decipher.final(\"utf8\");\n  return decrypted;\n}\n\nexport function hash(data) {\n  return crypto.createHash(\"sha1\").update(data).digest(\"hex\");\n}\n\nexport function uuid() {\n  // return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n  //   (c ^ (crypto.randomBytes(16)[0] & (15 >> (c / 4)))).toString(16)\n  // );\n  return nanoid();\n}\n\nexport function makeArray(v) {\n  return Array.isArray(v) ? v : [v];\n}\n\nexport function makeObject(prop) {\n  if (Array.isArray(prop)) {\n    return prop.reduce((p, c) => ({ ...p, ...c }));\n  }\n  return prop;\n}\n\n/**\n *\n * @param {Promise<{\n * ok:()=>any,\n *\n * }} promise\n * @returns\n */\nexport function async(promise) {\n  return promise\n    .then(result => ({\n      ok: true,\n      object: result,\n      asObject: () => makeObject(result),\n      asArray: () => makeArray(result),\n    }))\n    .catch(error => {\n      console.error(error);\n      return Promise.resolve({ ok: false, error });\n    });\n}\n","\"use strict\";\n\nconst uuid = require(\"../domain/utils\").uuid;\nconst SmartyStreetsSDK = require(\"smartystreets-javascript-sdk\");\n\nconst SmartyStreetsCore = SmartyStreetsSDK.core;\nconst Lookup = SmartyStreetsSDK.usStreet.Lookup;\n\n// for Server-to-server requests, use this code:\nconst disabled = process.env.SMARTY_DISABLED || false;\nconst authId = process.env.SMARTY_AUTH_ID;\nconst authToken = process.env.SMARTY_AUTH_TOKEN;\nconst credentials = new SmartyStreetsCore.StaticCredentials(authId, authToken);\n\nconst client = SmartyStreetsCore.buildClient.usStreet(credentials);\n\n/**\n * @typedef {{function(address):Promise<string>}} Address\n */\nexport const Address = {\n  // Documentation for input fields can be found at:\n  // https://smartystreets.com/docs/us-street-api#input-fields\n\n  async validateAddress(address) {\n    console.log(`REAL validating address...${address}`);\n\n    if (!address) {\n      console.log(\"no address\");\n      return;\n    }\n\n    if (disabled) {\n      console.log(\"address service disabled\");\n      return address;\n    }\n\n    let lookup = new Lookup();\n    lookup.inputId = uuid();\n    lookup.street = address;\n    lookup.maxCandidates = 1;\n\n    let response;\n    try {\n      response = await client.send(lookup);\n    } catch (error) {\n      throw new Error(error);\n    }\n\n    const candidate = response.lookups[0].result[0];\n    if (!candidate) {\n      throw new Error(\"invalid address\");\n    }\n\n    const validatedAddress = [\n      candidate.deliveryLine1,\n      candidate.deliveryLine2,\n      candidate.lastLine,\n    ].join(\" \");\n\n    console.log(`address: ${validatedAddress}`);\n\n    if (!validatedAddress) {\n      throw new Error(\"invalid address\");\n    }\n    return validatedAddress;\n  },\n};\n","\"use strict\";\n\n// Build EventBus client for host\nimport { listen, notify } from \"../adapters\";\nimport { Event } from \"./event-service\";\n\nconst _notify = notify(Event);\nconst _listen = listen(Event);\nconst model = { listen: _listen };\n\nexport const EventBus = {\n  notify(topic, message) {\n    return _notify({ model, args: [topic, message] });\n  },\n  listen(options) {\n    return _listen({ model, args: [options] });\n  },\n};\n","export * from \"./address-service\";\nexport * from \"./event-service\";\nexport * from \"./inventory-service\";\nexport * from \"./payment-service\";\nexport * from \"./shipping-service\";\nexport * from \"./event-bus\";","\"use strict\";\n\n// JSON.stringify({\n//     eventType: \"Command\",\n//     eventTime: new Date().toUTCString(),\n//     eventSource: \"orderService\",\n//     eventData: {\n//       replyChannel: \"orderChannel\",\n//       commandName: \"pickOrder\",\n//       commandArgs: {\n//       }\n","\"use strict\";\n\n/**\n * @callback authorizePaymentType\n * @param {string} id\n * @param {number} amount\n * @param {string} source_id\n * @param {string} customer_id\n * @param {boolean} [autocomplete]\n * @returns {Promise<string>}\n */\n\n/**\n * @typedef PaymentService\n * @property {authorizePaymentType} authorizePayment\n * @property {function()} completePayment\n * @property {function()} refundPayment\n */\n\n// import { Client, Environment, ApiError } from \"square\";\n\n// const client = new Client({\n//   environment: Environment.Sandbox,\n//   accessToken: process.env.SQUARE_ACCESS_TOKEN,\n// });\n\nexport const Payment = {\n  /**\n   * @type {authorizePaymentType}\n   * @param {*} id\n   * @param {*} amount\n   * @param {*} source_id\n   * @param {*} customer_id\n   * @param {*} autocomplete\n   * @param {*} currency\n   */\n  async authorizePayment(\n    id,\n    amount,\n    source_id,\n    customer_id,\n    autocomplete = false,\n    currency = \"USD\"\n  ) {\n    const payload = {\n      idempotency_key: id,\n      amount_money: {\n        amount,\n        currency,\n      },\n      source_id,\n      autocomplete,\n      customer_id,\n      location_id: \"XK3DBG77NJBFX\",\n      reference_id: \"123456\",\n      note: \"Brief description\",\n      app_fee_money: {\n        amount: 10,\n        currency: \"USD\",\n      },\n    };\n    /*\n    const bodyAmountMoney = {};\n    bodyAmountMoney.amount = 200;\n    bodyAmountMoney.currency = \"USD\";\n\n    const bodyTipMoney = {};\n    bodyTipMoney.amount = 198;\n    bodyTipMoney.currency = \"CHF\";\n\n    const bodyAppFeeMoney = {};\n    bodyAppFeeMoney.amount = 10;\n    bodyAppFeeMoney.currency = \"USD\";\n\n    const body = {\n      sourceId: \"ccof:uIbfJXhXETSP197M3GB\",\n      idempotencyKey: \"4935a656-a929-4792-b97c-8848be85c27c\",\n      amountMoney: bodyAmountMoney,\n    };\n\n    body.tipMoney = bodyTipMoney;\n    body.appFeeMoney = bodyAppFeeMoney;\n    body.delayDuration = \"delay_duration6\";\n    body.autocomplete = true;\n    body.orderId = \"order_id0\";\n    body.customerId = \"VDKXEEKPJN48QDG3BGGFAK05P8\";\n    body.locationId = \"XK3DBG77NJBFX\";\n    body.referenceId = \"123456\";\n    body.note = \"Brief description\";\n\n    // try {\n    //   const {\n    //     result,\n    //     ...httpResponse\n    //   } = await client.paymentsApi.createPayment(body);\n    //   // Get more response info...\n    //   // const { statusCode, headers } = httpResponse;\n    // } catch (error) {\n    //   if (error instanceof ApiError) {\n    //     const errors = error.result;\n    //     // const { statusCode, headers } = error;\n    //   }\n    // }\n    */\n    return \"1234\";\n  },\n\n  /*\n  const response ={\n  \"payment\": {\n    \"id\": \"GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\",\n    \"created_at\": \"2019-07-10T13:23:49.154Z\",\n    \"updated_at\": \"2019-07-10T13:23:49.446Z\",\n    \"amount_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"app_fee_money\": {\n      \"amount\": 10,\n      \"currency\": \"USD\"\n    },\n    \"total_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"status\": \"COMPLETED\",\n    \"source_type\": \"CARD\",\n    \"card_details\": {\n      \"status\": \"CAPTURED\",\n      \"card\": {\n        \"card_brand\": \"VISA\",\n        \"last_4\": \"1111\",\n        \"exp_month\": 7,\n        \"exp_year\": 2026,\n        \"fingerprint\": \"sq-1-TpmjbNBMFdibiIjpQI5LiRgNUBC7u1689i0TgHjnlyHEWYB7tnn-K4QbW4ttvtaqXw\",\n        \"card_type\": \"DEBIT\",\n        \"prepaid_type\": \"PREPAID\",\n        \"bin\": \"411111\"\n      },\n      \"entry_method\": \"ON_FILE\",\n      \"cvv_status\": \"CVV_ACCEPTED\",\n      \"avs_status\": \"AVS_ACCEPTED\",\n      \"auth_result_code\": \"nsAyY2\",\n      \"statement_description\": \"SQ *MY MERCHANT\"\n    },\n    \"location_id\": \"XTI0H92143A39\",\n    \"order_id\": \"m2Hr8Hk8A3CTyQQ1k4ynExg92tO3\",\n    \"reference_id\": \"123456\",\n    \"note\": \"Brief description\",\n    \"customer_id\": \"RDX9Z4XTIZR7MRZJUXNY9HUK6I\",\n    \"receipt_number\": \"GQTF\",\n    \"receipt_url\": \"https://squareup.com/receipt/preview/GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\"\n  }\n}\n  /*\n{\n  \"errors\": [\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"source_id\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"idempotency_key\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"MISSING_REQUIRED_PARAMETER\",\n      \"detail\": \"Field must be set\",\n      \"field\": \"amount_money\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    }\n  ]\n}\n  */\n\n  async completePayment(model) {\n    console.log(\"REAL completing payment: %s\", model.orderNo);\n    return \"1234\";\n  },\n\n  async refundPayment(model) {\n    console.log(\"REAL refunding payment: %s\", model.orderNo);\n  },\n};\n","\"use strict\";\n\n/**\n * @typedef {import('../adapters/event-adapter').EventMessage} EventMessage\n */\n\n/**\n * @typedef {import('../adapters/event-adapter').CommandEvent} CommandEvent\n */\n\n/**\n * @callback shipOrder\n * @param {string} shipTo\n * @param {string} shipFrom\n * @param {string} lineItems\n * @param {string} signature\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @callback trackShipment\n * @param {string} shipmentId\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @typedef {string} functionName\n */\n\n/**\n * @typedef {Object} shippingService formats and parses shipping event messages\n * @property {string} serviceName - programmatic service name in eventSource/Target\n * @property {string} topic - event topic \"shippingChannel\" when sending messasges\n * @property {shipOrder} shipOrder - format event message requesting shipping label and pickup of order\n * @property {trackShipment} trackShipment - report on location/status of parcel\n * @property {function():EventMessage} verifyDelivery - ensure customer recieved parcel\n * @property {function():EventMessage} returnShipment - return to sender if refunding\n * @property {function(functionName,EventMessage):{[key]:string}} getPayload - extract payload\n */\n\nfunction createEventMessage({ requester, service, type, name, id, data }) {\n  return {\n    eventSource: requester,\n    eventTarget: service,\n    eventType: type,\n    eventName: name,\n    eventTime: new Date().getTime(),\n    eventUuid: id,\n    eventData: data,\n  };\n}\n\nfunction createCommandEvent(name, topic, args) {\n  return {\n    commandName: name,\n    commandResp: topic,\n    commandArgs: { ...args },\n  };\n}\n\n/**\n * Shipping service events\n * @type {shippingService}\n */\nexport const Shipping = {\n  serviceName: \"shippingService\",\n  topic: \"shippingChannel\",\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {shipMessage}\n   */\n  shipOrder({\n    shipTo,\n    shipFrom,\n    lineItems,\n    signature,\n    externalId,\n    requester,\n    respondOn,\n  }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.shipOrder.name,\n      id: externalId,\n      data: createCommandEvent(this.shipOrder.name, respondOn, {\n        shipTo,\n        shipFrom,\n        lineItems,\n        signature,\n        externalId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  trackShipment({ externalId, shipmentId, trackingId, requester, respondOn }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.trackShipment.name,\n      id: externalId,\n      data: createCommandEvent(this.trackShipment.name, respondOn, {\n        externalId,\n        shipmentId,\n        trackingId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  verifyDelivery({ requester, respondOn, trackingId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.verifyDelivery.name,\n      id: externalId,\n      data: createCommandEvent(this.verifyDelivery.name, respondOn, {\n        externalId,\n        trackingId,\n      }),\n    });\n  },\n\n  returnShipment({ requester, respondOn, shipmentId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      id: externalId,\n      name: this.returnShipment.name,\n      data: createCommandEvent(this.returnShipment, respondOn, {\n        shipmentId,\n        externalId,\n      }),\n    });\n  },\n\n  getPayload(func, event) {\n    const payloads = {\n      [this.shipOrder.name]: {\n        shipmentId: event.eventData.shipmentId,\n      },\n      [this.trackShipment.name]: {\n        trackingId: event.eventData.trackingId,\n        trackingStatus: event.eventData.trackingStatus,\n      },\n      [this.verifyDelivery.name]: {\n        proofOfDelivery: event.eventData.proofOfDelivery,\n      },\n    };\n    return payloads[func];\n  },\n\n  getProperty(event, key) {\n    return event.eventData[key];\n  },\n};\n"],"sourceRoot":""}