{"version":3,"sources":["webpack://microlib-example/./src/adapters/address-adapter.js","webpack://microlib-example/./src/adapters/event-adapter.js","webpack://microlib-example/./src/adapters/index.js","webpack://microlib-example/./src/adapters/inventory-adapter.js","webpack://microlib-example/./src/adapters/payment-adapter.js","webpack://microlib-example/./src/adapters/shipping-adapter.js","webpack://microlib-example/./src/services/event-service.js"],"names":["validateAddress","service","options","order","model","args","callback","decrypt","shippingAddress","update","console","error","func","name","subscriptions","Map","filterMatches","message","filter","regex","RegExp","result","test","debug","substring","concat","Subscription","id","topic","filters","once","unsubscribe","get","getId","getModel","getSubscriptions","entries","every","subscription","listen","Event","arg","has","set","listening","forEach","notify","JSON","parse","pickOrder","Promise","resolve","reject","orderNo","event","log","pickupAddress","eventData","warehouse_addr","newOrder","then","stringify","eventType","eventTime","Date","toUTCString","eventSource","replyChannel","commandName","commandArgs","lineItems","orderItems","externalId","reason","Error","authorizePayment","paymentAuthorization","completePayment","confirmationCode","refundPayment","ORDER_SERVICE","ORDER_TOPIC","handleError","file","__filename","shipOrder","shipOrderCallback","callShipOrder","shipTo","shipFrom","signature","signatureRequired","requester","respondOn","payload","getPayload","updated","trackShipment","trackShipmentCallback","callTrackShipment","shipmentId","trackingStatus","verifyDelivery","verifyDeliveryCallback","callVerifyDelivery","trackingId","brokers","process","env","KAFKA_BROKERS","topics","KAFKA_TOPICS","groupId","KAFKA_GROUP_ID","pid","kafka","Kafka","clientId","split","consumer","producer","connect","subscribe","fromBeginning","run","eachMessage","value","toString","send","messages","disconnect"],"mappings":"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","file":"610.js","sourcesContent":["\"use strict\";\n\n/**\n * @typedef {import('../domain/order').Order} Order\n * @typedef {string} address\n * @callback adapterFactory\n * @param {service} service\n * @returns {function({model:Order})} - verified/corrected address\n */\n\n/**\n *\n * @type {adapterFactory}\n * @param {import(\"../services/address-service\").Address} service\n */\nexport function validateAddress(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n\n    try {\n      const shippingAddress = await service.validateAddress(\n        order.decrypt().shippingAddress\n      );\n      const update = await callback(options, { shippingAddress });\n      return update;\n    } catch (error) {\n      console.error({ func: validateAddress.name, error, options });\n    }\n  };\n}\n","\"use strict\";\n\n/**\n * @typedef {import('../domain').Model} Model\n * @typedef {string} serviceName\n *\n * @typedef {Object} EventMessage\n * @property {serviceName} eventSource\n * @property {serviceName|\"broadcast\"} eventTarget\n * @property {\"command\"|\"commandResponse\"|\"notification\"|\"import\"} eventType\n * @property {string} eventName\n * @property {string} eventTime\n * @property {string} eventUuid\n * @property {NotificationEvent|ImportEvent|CommandEvent} eventData\n *\n * @typedef {object} ImportEvent\n * @property {\"service\"|\"model\"|\"adapter\"} type\n * @property {string} url\n * @property {string} path\n * @property {string} importRemote\n *\n * @typedef {object} NotificationEvent\n * @property {string|} message\n * @property {\"utf8\"|Uint32Array} encoding\n *\n * @typedef {Object} CommandEvent\n * @property {string} commandName\n * @property {string} commandResp\n * @property {*} commandArgs\n */\n\n/**\n * @typedef {{\n *  filter:function(message):Promise<void>,\n *  unsubscribe:function()\n * }} Subscription\n * @typedef {string|RegExp} topic\n * @callback eventHandler\n * @param {string} eventData\n * @typedef {eventHandler} notifyType\n * @typedef {{\n * listen:function(topic, x),\n * notify:notifyType\n * }} EventService\n * @callback adapterFactory\n * @param {EventService} service\n * @returns {function(topic, eventHandler)}\n */\nimport { Event } from \"../services/event-service\";\n\n/**\n * @type {Map<any,Map<string,*>>}\n */\nconst subscriptions = new Map();\n\n/**\n * Test the filter.\n * @param {string} message\n * @returns {function(string|RegExp):boolean} did the filter match?\n */\nfunction filterMatches(message) {\n  return function (filter) {\n    const regex = new RegExp(filter);\n    const result = regex.test(message);\n    if (result)\n      console.debug({\n        func: filterMatches.name,\n        filter,\n        result,\n        message: message.substring(0, 100).concat(\"...\"),\n      });\n    return result;\n  };\n}\n\n/**\n * @typedef {string} message\n * @typedef {string|RegExp} topic\n * @param {{\n *  id:string,\n *  callback:function(message,Subscription),\n *  topic:topic,\n *  filter:string|RegExp,\n *  once:boolean,\n *  model:import(\"../domain\").Model\n * }} options\n */\nconst Subscription = function ({ id, callback, topic, filters, once, model }) {\n  return {\n    /**\n     * unsubscribe from topic\n     */\n    unsubscribe() {\n      subscriptions.get(topic).delete(id);\n    },\n\n    getId() {\n      return id;\n    },\n\n    getModel() {\n      return model;\n    },\n\n    getSubscriptions() {\n      return [...subscriptions.entries()];\n    },\n\n    /**\n     * Filter message and invoke callback\n     * @param {string} message\n     */\n    async filter(message) {\n      if (filters) {\n        // Every filter must match.\n        if (filters.every(filterMatches(message))) {\n          if (once) {\n            // Only looking for 1 msg, got it.\n            this.unsubscribe();\n          }\n          await callback({ message, subscription: this });\n          return;\n        }\n        // no match\n        return;\n      }\n      // no filters defined, just invoke the callback.\n      await callback({ message, subscription: this });\n    },\n  };\n};\n\n/**\n * Listen for external events with default event service if none specified.\n * @type {adapterFactory}\n * @param {import('../services/event-service').Event} [service] - has default service\n */\nexport function listen(service = Event) {\n  return async function (options) {\n    const {\n      model,\n      args: [arg],\n    } = options;\n\n    const subscription = Subscription({ model, ...arg });\n\n    if (subscriptions.has(arg.topic)) {\n      subscriptions.get(arg.topic).set(arg.id, subscription);\n      return subscription;\n    }\n\n    subscriptions.set(arg.topic, new Map().set(arg.id, subscription));\n\n    if (!service.listening) {\n      service.listen(/Channel/, async function ({ topic, message }) {\n        if (subscriptions.has(topic)) {\n          subscriptions.get(topic).forEach(async subscription => {\n            await subscription.filter(message);\n          });\n        }\n      });\n    }\n    return subscription;\n  };\n}\n\n/**\n * @type {adapterFactory}\n * @returns {function(topic, eventData)}\n */\nexport function notify(service = Event) {\n  return async function ({ model, args: [topic, message] }) {\n    console.debug(\"sending...\", { topic, message: JSON.parse(message) });\n    await service.notify(topic, message);\n    return model;\n  };\n}\n","\"use strict\";\n\nexport * from \"./address-adapter\";\nexport * from \"./payment-adapter\";\nexport * from \"./shipping-adapter\";\nexport * from \"./event-adapter\";\nexport * from \"./inventory-adapter\";\n\n/**\n * @typedef {import('../domain').Model} Model\n * @typedef {function(function(eventCallback):Promise<Model>)} adapterFunction\n */\n","\"use strict\";\n\n/**\n * @typedef {string|RegExp} topic\n * @callback eventCallback\n * @param {string} message\n * @param {{\n *  getModel:function():object,\n *  unsubscribe:function()\n * }} subscription\n * @typedef {eventCallback} shipOrderType\n * @param topic,\n * @param eventCallback\n * @typedef {{\n *  shipOrder:shipOrderType,\n *  trackShipment:function(),\n *  verifyDelivery:function()\n * }} InventoryAdapter\n * @typedef {import('../domain/order').Order} Order\n * @typedef {InventoryAdapter} service \n * @typedef {{\n *  listen:function(topic,RegExp,eventCallback)\n *  notify:function(topic,eventCallback)\n * }} event\n * @callback adapterFactory\n * @param {service} service\n * @param {event} event\n * @returns {function({\n * model:Order,\n * resolve:function()\n * ,args:[\n * eventCallback, \n * options:{}]\n * })}\n   \n }]})} \n *\n */\n\n/**\n * @type {adapterFactory}\n */\nexport function pickOrder(service) {\n  return function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n\n    return new Promise(function (resolve, reject) {\n      // start listening first then send the event\n      return order\n        .listen({\n          once: true,\n          model: order,\n          id: order.orderNo,\n          topic: \"orderChannel\",\n          filters: [order.orderNo, \"orderPicked\", \"warehouse_addr\"],\n          callback: async ({ message }) => {\n            try {\n              const event = JSON.parse(message);\n              console.log(\"recieved event: \", event);\n              const pickupAddress = event.eventData.warehouse_addr;\n              const newOrder = await callback(options, { pickupAddress });\n              resolve(newOrder); // hold promise until we get an answer\n            } catch (error) {\n              reject(error);\n            }\n          },\n        })\n        .then(() => {\n          return order.notify(\n            \"inventoryChannel\",\n            JSON.stringify({\n              eventType: \"Command\",\n              eventTime: new Date().toUTCString(),\n              eventSource: \"orderService\",\n              eventData: {\n                replyChannel: \"orderChannel\",\n                commandName: \"pickOrder\",\n                commandArgs: {\n                  lineItems: order.orderItems,\n                  externalId: order.orderNo,\n                },\n              },\n            })\n          );\n        })\n        .catch((reason) => {\n          throw new Error(reason);\n        });\n    });\n  };\n}\n","\"use strict\";\n\n/**\n * @typedef {import('../domain/order').Order} Order\n * @typedef\n * @callback adapterFactory\n * @param {service} service\n * @returns {function({model:Order,parms:any[]})}\n */\n\n/**\n * @type {adapterFactory}\n * @param {import(\"../services/payment-service\").PaymentService} service\n */\nexport function authorizePayment(service) {\n  return async function (options) {\n      const {\n        model: order,\n        args: [callback],\n      } = options;\n\n      const paymentAuthorization = await service.authorizePayment(\n        order.orderNo,\n        12.0,\n        \"src\",\n        \"ibm\",\n        false\n      );\n      return callback(options, { paymentAuthorization });\n  };\n}\n\n/**\n * @type {adapterFactory}\n */\nexport function completePayment(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n    const confirmationCode = await service.completePayment(order);\n    const newOrder = await callback(options, { confirmationCode });\n    return newOrder;\n  };\n}\n/**\n * @type {adapterFactory}\n */\nexport function refundPayment(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n    await service.refundPayment(order);\n    const newOrder = await callback(options);\n    return newOrder;\n  };\n}\n","\"use strict\";\n\n/**\n * @callback portCallback\n * @param {{options:{}}}\n * @param {{payload:{[key]:string}}}\n */\n\n/**\n * @typedef {string} message\n * @callback eventCallback\n * @param {string} message\n * @param {{\n *  unsubscribe:function(),\n *  filter:function(message):boolean\n * }} subscription\n */\n\n/**\n * @typedef {import('../domain/order').Order} Order\n */\n\n/**\n * @typedef {import(\"../services/shipping-service\").shippingService} shippingService\n */\n\n/**\n * @typedef {{\n *  listen:function(topic,RegExp,portCallback)\n *  notify:function(topic,eventCallback)\n * }} event\n */\n\n/**\n * @callback adapterFactory\n * @param {service} service\n * @returns {function({model:Order,args:[portCallback]}):Order}\n */\n\nconst ORDER_SERVICE = \"orderService\";\nconst ORDER_TOPIC = \"orderChannel\";\n\nconst handleError = (error, reject = null, func = null) => {\n  console.error({ file: __filename, func, error });\n  if (reject) reject(error);\n};\n\n/**\n * Call `shipOrder` to request shipment of the order items.\n * @param {import('../services/shipping-service').shippingService} service\n * @type {adapterFactory}\n * @returns {function(options):Promise<Order>}\n * Return a promise that is resolved once we receive\n * a response message from the shipping service. Start\n * listening for the response first and then send the\n * request message.\n *\n */\nexport function shipOrder(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n\n    /**\n     * Called by the event listener when the shipOrder\n     * response message arrives. Resolve the promise\n     * the caller has been waiting on since we sent\n     * the request message.\n     * @param {function(Order)} resolve\n     * @param {function(Error)} reject\n     * @returns {function(message):Promise<Order>}\n     */\n    function shipOrderCallback(resolve, reject) {\n      return async function ({ message }) {\n        try {\n          const event = JSON.parse(message);\n          console.debug(\"received event... \", event);\n          const payload = service.getPayload(shipOrder.name, event);\n          const updated = await callback(options, payload);\n          resolve(updated);\n        } catch (error) {\n          handleError(error, reject, shipOrderCallback.name);\n        }\n      };\n    }\n\n    /**\n     * Send the shipOrder event to the shipping service.\n     */\n    function callShipOrder() {\n      return order.notify(\n        service.topic,\n        JSON.stringify(\n          service.shipOrder({\n            shipTo: order.decrypt().shippingAddress,\n            shipFrom: order.pickupAddress,\n            lineItems: order.orderItems,\n            signature: order.signatureRequired,\n            externalId: order.orderNo,\n            requester: ORDER_SERVICE,\n            respondOn: ORDER_TOPIC,\n          })\n        )\n      );\n    }\n\n    return new Promise(function (resolve, reject) {\n      return order\n        .listen({\n          once: true,\n          model: order,\n          id: order.orderNo,\n          topic: ORDER_TOPIC,\n          filters: [order.orderNo, \"orderShipped\", \"shipmentId\"],\n          callback: shipOrderCallback(resolve, reject),\n        })\n        .then(callShipOrder)\n        .catch(handleError);\n    });\n  };\n}\n\n/**\n * @param {import('../services/shipping-service').shippingService} service\n * @type {adapterFactory}\n */\nexport function trackShipment(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n\n    /**\n     *\n     * @param {function(Order)} resolve resolve the promise\n     * @param {function(Error)} reject reject promise\n     */\n    function trackShipmentCallback(resolve, reject) {\n      return async function ({ message, subscription }) {\n        try {\n          const event = JSON.parse(message);\n          console.debug(\"received event...\", event);\n          const payload = service.getPayload(trackShipment.name, event);\n          const updated = await callback(options, payload);\n          if (updated.trackingStatus === \"orderDelivered\") {\n            subscription.unsubscribe();\n            resolve(updated);\n          }\n        } catch (error) {\n          handleError(error, reject, trackShipment.name);\n        }\n      };\n    }\n\n    function callTrackShipment() {\n      return order.notify(\n        service.topic,\n        JSON.stringify(\n          service.trackShipment({\n            shipmentId: order.shipmentId,\n            externalId: order.orderNo,\n            requester: ORDER_SERVICE,\n            respondOn: ORDER_TOPIC,\n          })\n        )\n      );\n    }\n\n    return new Promise(async function (resolve, reject) {\n      return order\n        .listen({\n          once: false,\n          model: order,\n          id: order.orderNo,\n          topic: ORDER_TOPIC,\n          filters: [order.orderNo, \"trackingId\", \"trackingStatus\"],\n          callback: trackShipmentCallback(resolve, reject),\n        })\n        .then(callTrackShipment)\n        .catch(handleError);\n    });\n  };\n}\n\n/**\n * @param {import('../services/shipping-service').shippingService} service\n * @type {adapterFactory}\n */\nexport function verifyDelivery(service) {\n  return async function (options) {\n    const {\n      model: order,\n      args: [callback],\n    } = options;\n\n    /**\n     *\n     * @param {function(Order)} resolve\n     * @param {function(Error)} reject\n     * @returns\n     */\n    function verifyDeliveryCallback(resolve, reject) {\n      return async function ({ message }) {\n        try {\n          const event = JSON.parse(message);\n          console.debug(\"received event...\", event);\n          const payload = service.getPayload(verifyDelivery.name, event);\n          const updated = await callback(options, payload);\n          resolve(updated);\n        } catch (e) {\n          handleError(e, reject, verifyDeliveryCallback.name);\n        }\n      };\n    }\n\n    function callVerifyDelivery() {\n      return order.notify(\n        service.topic,\n        JSON.stringify(\n          service.verifyDelivery({\n            trackingId: order.trackingId,\n            externalId: order.orderNo,\n            requester: ORDER_SERVICE,\n            respondOn: ORDER_TOPIC,\n          })\n        )\n      );\n    }\n\n    return new Promise(async function (resolve, reject) {\n      return order\n        .listen({\n          once: true,\n          model: order,\n          id: order.orderNo,\n          topic: \"orderChannel\",\n          filters: [order.orderNo, \"deliveryVerified\", \"proofOfDelivery\"],\n          callback: verifyDeliveryCallback(resolve, reject),\n        })\n        .then(callVerifyDelivery)\n        .catch(handleError);\n    });\n  };\n}\n","\"use strict\";\n\nimport { Kafka } from \"kafkajs\";\n\nconst brokers = process.env.KAFKA_BROKERS || \"localhost:9092\";\nconst topics = new RegExp(process.env.KAFKA_TOPICS) || /Channel/;\nconst groupId = (process.env.KAFKA_GROUP_ID || \"MicroLib\") + process.pid;\n\nconst kafka = new Kafka({\n  clientId: \"MicroLib\",\n  brokers: brokers.split(\",\"),\n});\n\nconst consumer = kafka.consumer({ groupId });\nconst producer = kafka.producer();\n\n/**\n * @typedef {EventService}\n */\nexport const Event = {\n  listening: false,\n  topics,\n\n  /**\n   * Implements event consumer service.\n   * @param {string|RegExp} topic\n   * @param {function({message, topic})} callback\n   */\n  async listen(topic, callback) {\n    try {\n      await consumer.connect();\n      await consumer.subscribe({ topic, fromBeginning: true });\n      this.listening = true;\n      await consumer.run({\n        eachMessage: async ({ topic, message }) => {\n          try {\n            callback({\n              topic,\n              message: message.value.toString(),\n            });\n          } catch (error) {\n            console.error(error);\n          }\n        },\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  },\n\n  /**\n   * Implemements event producer service.\n   * @param {string|RegExp} topic\n   * @param {string} message\n   */\n  async notify(topic, message) {\n    try {\n      await producer.connect();\n      await producer.send({\n        topic: topic,\n        messages: [{ value: message }],\n      });\n      await producer.disconnect();\n    } catch (error) {\n      console.error({ func: this.notify.name, error });\n    }\n  },\n};\n"],"sourceRoot":""}